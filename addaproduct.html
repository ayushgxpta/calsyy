<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Product Admin Panel</title>
  <link rel="stylesheet" href="addaproduct.css">
</head>
<body>
  <div class="admin-container">
    <h1>Product Management Dashboard</h1>
    
    <!-- Product Form -->
    <form id="product-form">
      <!-- Basic Information -->
      <div class="form-section">
        <h2>Basic Information</h2>
        <div class="form-row">
          <div class="form-group">
            <label for="product-name">Product Name</label>
            <input type="text" id="product-name" required>
          </div>
          <div class="form-group">
            <label for="product-price">Price</label>
            <input type="number" id="product-price" step="0.01" required>
          </div>
          <div class="form-group">
            <label for="corrected-price">Corrected Price</label>
            <input type="number" id="corrected-price" step="0.01">
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="product-category">Category</label>
            <select id="product-category" required>
              <option value="Best Sellers">Best Sellers</option>
              <option value="Trending Products">Trending Products</option>
              <option value="Home Decor">Home Decor</option>
              <option value="Electronics">Electronics</option>
              <option value="Fashion">Fashion</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Image Uploads -->
      <div class="form-section">
        <h2>Image Uploads</h2>
        <div class="image-upload-group">
          <div class="form-group">
            <label>Product Images (5 required)</label>
            <input type="file" id="product-images" accept="image/*" multiple required>
          </div>
          <div class="form-group">
            <label>Description Images (3 required)</label>
            <input type="file" id="description-images" accept="image/*" multiple required>
          </div>
        </div>
      </div>

      <!-- Descriptions -->
      <div class="form-section">
        <h2>Descriptions</h2>
        <div class="form-group">
          <label for="mini-description">Mini Description</label>
          <textarea id="mini-description" rows="2"></textarea>
        </div>
        <div class="form-group">
          <label for="product-description">Full Description</label>
          <textarea id="product-description" rows="4"></textarea>
        </div>
      </div>

      <!-- Reviews -->
      <div class="form-section">
        <h2>Customer Reviews</h2>
        
        <!-- Review Pair 1 -->
        <div class="review-pair">
          <h3>Review Pair 1</h3>
          <div class="form-group">
            <label for="review-customer-1">Review Customer 1 Name:</label>
            <input type="text" id="review-customer-1">
          </div>
          <div class="form-group">
            <label for="review-1">Review 1 Text:</label>
            <textarea id="review-1" rows="3"></textarea>
          </div>
        </div>

        <!-- Review Pair 2 -->
        <div class="review-pair">
          <h3>Review Pair 2</h3>
          <div class="form-group">
            <label for="review-customer-2">Review Customer 2 Name:</label>
            <input type="text" id="review-customer-2">
          </div>
          <div class="form-group">
            <label for="review-2">Review 2 Text:</label>
            <textarea id="review-2" rows="3"></textarea>
          </div>
        </div>

        <!-- Review Pair 3 -->
        <div class="review-pair">
          <h3>Review Pair 3</h3>
          <div class="form-group">
            <label for="review-customer-3">Review Customer 3 Name:</label>
            <input type="text" id="review-customer-3">
          </div>
          <div class="form-group">
            <label for="review-3">Review 3 Text:</label>
            <textarea id="review-3" rows="3"></textarea>
          </div>
        </div>

        <!-- Review Pair 4 -->
        <div class="review-pair">
          <h3>Review Pair 4</h3>
          <div class="form-group">
            <label for="review-customer-4">Review Customer 4 Name:</label>
            <input type="text" id="review-customer-4">
          </div>
          <div class="form-group">
            <label for="review-4">Review 4 Text:</label>
            <textarea id="review-4" rows="3"></textarea>
          </div>
        </div>

        <!-- Review Pair 5 -->
        <div class="review-pair">
          <h3>Review Pair 5</h3>
          <div class="form-group">
            <label for="review-customer-5">Review Customer 5 Name:</label>
            <input type="text" id="review-customer-5">
          </div>
          <div class="form-group">
            <label for="review-5">Review 5 Text:</label>
            <textarea id="review-5" rows="3"></textarea>
          </div>
        </div>
      </div>

      <button type="submit">Add Product</button>
    </form>

    <!-- Product List -->
    <div class="product-list">
      <h2>Existing Products</h2>
      <div id="product-list"></div>
    </div>
  </div>

  <script>
    const API_BASE = 'https://calsyy-backend.onrender.com/api/products';
    const productForm = document.getElementById('product-form');

    // Convert files to Base64 strings
    const readFilesAsBase64 = (files) => {
      return Promise.all(Array.from(files).map(file => 
        new Promise((resolve) => {
          const reader = new FileReader();
          reader.onload = () => resolve(reader.result); // Base64 string
          reader.readAsDataURL(file);
        })
      ));
    };

    // Form submission handler
    productForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Collect form data
      const formData = {
        name: document.getElementById('product-name').value,
        price: parseFloat(document.getElementById('product-price').value),
        correctedPrice: parseFloat(document.getElementById('corrected-price').value) || undefined,
        category: document.getElementById('product-category').value,
        miniDescription: document.getElementById('mini-description').value,
        description: document.getElementById('product-description').value,
        reviews: {
          customer1: document.getElementById('review-customer-1').value,
          review1: document.getElementById('review-1').value,
          customer2: document.getElementById('review-customer-2').value,
          review2: document.getElementById('review-2').value,
          customer3: document.getElementById('review-customer-3').value,
          review3: document.getElementById('review-3').value,
          customer4: document.getElementById('review-customer-4').value,
          review4: document.getElementById('review-4').value,
          customer5: document.getElementById('review-customer-5').value,
          review5: document.getElementById('review-5').value
        }
      };

      try {
        // Process product images (5 required)
        const productImages = document.getElementById('product-images').files;
        if (productImages.length !== 5) throw new Error('Exactly 5 product images required');
        formData.images = await readFilesAsBase64(productImages);

        // Process description images (3 required)
        const descImages = document.getElementById('description-images').files;
        if (descImages.length !== 3) throw new Error('Exactly 3 description images required');
        formData.descriptionPictures = await readFilesAsBase64(descImages);

        // Send JSON payload to backend
        const response = await fetch(API_BASE, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Failed to add product');
        }

        alert('Product added successfully!');
        productForm.reset();
        loadProducts();
      } catch (error) {
        alert(`Error: ${error.message}`);
        console.error('Submission error:', error);
      }
    });

    // Load and display products
    async function loadProducts() {
      try {
        const response = await fetch(API_BASE);
        const products = await response.json();
        
        const productList = document.getElementById('product-list');
        productList.innerHTML = products.map(product => `
          <div class="product-item">
            <div>
              <h3>${product.name}</h3>
              <p>Price: ₹${product.price} ${product.correctedPrice ? `(₹${product.correctedPrice})` : ''}</p>
              <p>Category: ${product.category}</p>
            </div>
            <button onclick="deleteProduct('${product._id}')">Delete</button>
          </div>
        `).join('');
      } catch (error) {
        console.error('Error loading products:', error);
      }
    }

    // Delete product
    async function deleteProduct(id) {
      if (!confirm('Are you sure you want to delete this product?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/${id}`, {
          method: 'DELETE'
        });

        if (!response.ok) throw new Error('Failed to delete product');
        
        alert('Product deleted successfully');
        loadProducts();
      } catch (error) {
        alert(`Error: ${error.message}`);
      }
    }

    // Initial load
    window.addEventListener('load', loadProducts);
  </script>
</body>
</html>